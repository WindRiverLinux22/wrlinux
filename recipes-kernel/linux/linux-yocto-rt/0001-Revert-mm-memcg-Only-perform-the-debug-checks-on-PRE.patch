From 12d00ba083b5a499dd2d9711603bbbf5cc2cf799 Mon Sep 17 00:00:00 2001
From: Hongxu Jia <hongxu.jia@windriver.com>
Date: Mon, 17 Apr 2023 11:36:14 +0800
Subject: [PATCH] Revert "mm/memcg: Only perform the debug checks on
 !PREEMPT_RT"

This reverts commit debedeb4264e87b8625b7421b2f8f7688b42d192.

This commit caused podman does not work

Upstream-Status: Inappropriate [aptiv specific]

Signed-off-by: Hongxu Jia <hongxu.jia@windriver.com>
---
 init/Kconfig    | 1 +
 mm/memcontrol.c | 2 +-
 2 files changed, 2 insertions(+), 1 deletion(-)

diff --git a/init/Kconfig b/init/Kconfig
index e5241e11429c..35f0e37abef8 100644
--- a/init/Kconfig
+++ b/init/Kconfig
@@ -947,6 +947,7 @@ config PAGE_COUNTER
 
 config MEMCG
 	bool "Memory controller"
+	depends on !PREEMPT_RT
 	select PAGE_COUNTER
 	select EVENTFD
 	help
diff --git a/mm/memcontrol.c b/mm/memcontrol.c
index 71b7b7371595..195239c4577a 100644
--- a/mm/memcontrol.c
+++ b/mm/memcontrol.c
@@ -773,7 +773,7 @@ void __mod_memcg_lruvec_state(struct lruvec *lruvec, enum node_stat_item idx,
 	 * interrupt context while other caller need to have disabled interrupt.
 	 */
 	__memcg_stats_lock();
-	if (IS_ENABLED(CONFIG_DEBUG_VM) && !IS_ENABLED(CONFIG_PREEMPT_RT)) {
+	if (IS_ENABLED(CONFIG_DEBUG_VM)) {
 		switch (idx) {
 		case NR_ANON_MAPPED:
 		case NR_FILE_MAPPED:
-- 
2.27.0

